build_base_venvs:
  extends: .cached_testrunner
  stage: setup
  needs: []
  parallel:
    matrix:
      - PYTHON_VERSION: ["3.9", "3.10", "3.11", "3.12", "3.13", "3.14"]
  variables:
    PIP_VERBOSE: '0'
    DD_PROFILING_NATIVE_TESTS: '1'
  script: |
    set -e -o pipefail
    pip install -U git+https://github.com/DataDog/riot.git@brettlangdon/wheel-source

    if [ -z "$RIOT_WHEEL_SOURCE" ]; then
      echo "RIOT_WHEEL_SOURCE is not set"
      exit 1
    fi
    riot -P -v generate --python=$PYTHON_VERSION
    rm -rf ddtrace/
    echo "Running smoke tests"
    riot -v run -s --python=$PYTHON_VERSION smoke_test
  artifacts:
    name: venv_$PYTHON_VERSION
    paths:
      - .riot/venv_*
