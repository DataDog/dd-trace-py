variables:
  TESTRUNNER_IMAGE: registry.ddbuild.io/dd-trace-py:v81799905-0f9bd8b-testrunner@sha256:f29e49e817cb3fdcc188414b9e94bd9244df7db00b72205738a752ab23953cc5

.testrunner:
  image:
    name: ${TESTRUNNER_IMAGE}
    docker:
      user: bits
  # DEV: we have a larger pool of amd64 runners, prefer that over arm64
  tags: [ "arch:amd64" ]
  timeout: 20m
  before_script:
    - ulimit -c unlimited
    - git config --global --add safe.directory ${CI_PROJECT_DIR}
    - pyenv global 3.12 3.9 3.10 3.11 3.13 3.14
    - export _CI_DD_AGENT_URL=http://${HOST_IP}:8126/
  retry: 2
  artifacts:
    reports:
      junit: test-results/junit*.xml

.testrunner_gpu:
  extends: .testrunner
  image:
    name: ${TESTRUNNER_IMAGE}
  tags: [ "gpu:a10-amd64" ]
  timeout: 40m
  before_script:
    - !reference [.testrunner, before_script]
    - export NVIDIA_VISIBLE_DEVICES=all
    - export NVIDIA_DRIVER_CAPABILITIES=compute,utility
