id: span-metrics-subscript-write
language: Python
severity: error
message: >
  Direct write to span._metrics is forbidden. Use span._set_numeric_attribute(key, value) instead.
note: >
  span._metrics is now a read-only property that materializes the underlying HashMap.
  Writes to it are silently discarded. Migrate to span._set_numeric_attribute(key, value).
rule:
  pattern: $X._metrics[$Y] = $Z
constraints:
  X:
    not:
      regex: "context$"
ignores:
  - ddtrace/_trace/context.py
  - ddtrace/internal/writer/writer.py
