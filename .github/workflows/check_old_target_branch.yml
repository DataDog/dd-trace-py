name: Check for Old Target Branch

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check_target_branch:
    runs-on: ubuntu-latest
    steps:
      - name: Check if target branch is too old to backport
        id: check-branch
        run: |
          # Define regex for branches with major version 0 or 1, or versions from 2.0 to 2.12
          old_branch_regex="^(0|1)(\\.|$)|^2\\.([0-9]|1[0-2])(\\.|$)"
          target_branch="${{ github.event.pull_request.base.ref }}"
          
          if [[ "$target_branch" =~ $old_branch_regex ]]; then
              echo "Old target branch detected: $target_branch"
              echo "::set-output name=old_branch::true"
              exit 1
          else
              echo "::set-output name=old_branch::false"
          fi

      - name: Comment on PR if blacklisted
        if: steps.check-branch.outputs.old_branch == 'true'
        uses: thollander/actions-comment-pull-request@v2
        with:
          message: |
            ðŸš« **This target branch is too old or unsupported. Please update the target branch to continue.**
