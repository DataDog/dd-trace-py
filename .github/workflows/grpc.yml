name: grpc-testsuite
on:
  push:
    branches:
      - master
  pull_request:
jobs:
  grpc-testsuite-1_37_1:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: grpc
    steps:
      - uses: actions/setup-python@v2
        with:
          python-version: '3.9'
      - uses: actions/checkout@v2
        with:
          repository: grpc/grpc
          ref: $BASE_BRANCH
          path: grpc
      - uses: actions/checkout@v2
        with:
          path: ddtrace
      #install grpc
      - name: Install grpc
        run: pip install grpcio
      #install grpc tools
      - name: Install grpc tools
        run: pip install grpcio-tools
      - name: Inject ddtrace
        run: pip install ../ddtrace
      - name: Install Pytest
        run: pip install pytest
      - name: Run Http2 test suite 
        run: ddtrace-run pytest test/http2_test
      - name: Run Distrib test suite for python
        run: ddtrace-run pytest test/distrib/python
