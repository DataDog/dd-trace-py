name: Public API
on:
  pull_request:
  push:
    branches:
      - main
jobs:
  check_api:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.9'
      - name: Install doxxie
        run: pip install git+git://github.com/Kyle-Verhoog/doxxie.git@f2ff3d53fea7dd119c4922eac5ddd371f3553539
      - name: Install mypy
        run: pip install git+git://github.com/python/mypy.git@66c2ac516305f194a9bc37c1ebf7f22d62d6141c
      - name: Generate public API
        run: doxxie --public-api-only --public-api-exclude=ddtrace.internal ddtrace --output public_api
      - name: Check API for changes
        run: git diff --exit-code
